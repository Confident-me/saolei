!function(){function n(){p=document.getElementById("mine"),L=Number(p.getAttribute("data-unit-size"))||21;var n=p.querySelector.bind(p),e=0,i=document.createElement("style");i.innerHTML="#game span{width:"+L+"px;height:"+L+"px;line-height:"+L+"px;}",document.head.appendChild(i),p.innerHTML="<label>剩余地雷：<span id=mines>10</span></label><label>已用时间：<span id=time>0</span>s</label><label>级别：<select id=level></select><button id=new>重新开始</button></label><div id=msg></div><div id=game></div>",c=n("#game"),d=n("#msg"),f=n("#mines"),M=n("#level"),v=n("#time"),g=n("#new"),i=[],j.forEach(function(n){i.push("<option value="+e++ +">"+n.name+"</option>")}),M.innerHTML=i.join(""),M.value=0,g.onclick=M.onchange=a,c.onclick=c.oncontextmenu=function(n){if(n.preventDefault(),q){var e=T.indexOf(n.target);e>=0&&l(e,n.type)}},a()}function e(n){var e={};return e.top=2+Math.floor(n/H.width)*(L+4),e.left=2+n%H.width*(L+4),e}function i(n,e){function i(i){(i!=n||e)&&t.push(i),i%a&&t.push(i-1),(i+1)%a&&t.push(i+1)}var t=[],a=H.width;return n>=a&&i(n-a),i(n),b>n+a&&i(n+a),t}function t(n){q=b-H.mines,w=[];var e,t,a,o=H.mines,m=b-9,h=Math.floor(n/H.width),s=n%H.width;for(e=0,h&&h!=H.height-1||e++,s&&s!=H.width-1||e++,e--&&(m+=3,e&&(m+=2)),e=0;b>e;e++)a=Math.abs(Math.floor(e/H.width)-h)<=1&&Math.abs(e%H.width-s)<=1,t={mine:!a&&o/m>Math.random(),num:0},w.push(t),t.mine&&o--,a||m--;for(e=0;b>e;e++)w[e].mine&&i(e).forEach(function(n){w[n].num++});d.innerHTML="开始了，小心一点！",r(1)}function a(){var n,i,t=[];for(k=M.value,H=j[k],b=H.width*H.height,i="<span>"+N+"</span>",n=0;b>n;n++)t.push(i);for(c.innerHTML=t.join(""),c.style.maxWidth=(L+4)*H.width+4+"px",c.style.height=(L+4)*H.height+4+"px",T=[],n=0;b>n;n++)t=c.childNodes[n],i=e(n),t.style.top=i.top+"px",t.style.left=i.left+"px",T.push(t);f.innerHTML=x=H.mines,d.innerHTML="准备开始吧...",q=-1,r(-1)}function r(n){y&&(clearInterval(y),y=null);var e;0>n?v.innerHTML=e=0:n&&(e=0,y=setInterval(function(){v.innerHTML=++e},1e3))}function o(n){var e=0,t=0;return w[n].open&&(t=i(n).every(function(n){return!w[n].mine&&w[n].marked&&(e=1),!w[n].mine^w[n].marked}),e&&u(-1)),t}function m(n){i(n).forEach(s)}function h(n){function e(){i(n).forEach(function(n){w[n].open||w[n].marked||T[n].classList.toggle("spark")})}e(),setTimeout(e,200)}function s(n){if(!w[n].open&&!w[n].marked)if(w[n].mine)u(n);else if(T[n].className="open",w[n].open=1,q--,w[n].num?T[n].innerHTML=w[n].num:m(n),!q){for(d.innerHTML="你赢了！",n=0;b>n;n++)w[n].mine&&!w[n].marked&&(T[n].innerHTML=E);r(),f.innerHTML=0}}function l(n,e){switch(e){case"click":0>q&&t(n),w[n].open?o(n)?m(n):h(n):s(n);break;case"contextmenu":w[n].open||((w[n].marked=!w[n].marked)?(T[n].innerHTML=E,f.innerHTML=--x):(T[n].innerHTML=N,f.innerHTML=++x))}}function u(n){var e;for(n>=0&&(e=T[n],e.className="wrong",e.innerHTML=I),q=0,d.innerHTML="你输了！",r(),e=0;b>e;e++)!w[e].mine&&w[e].marked?(T[e].className="wrong",T[e].innerHTML=I):w[e].mine&&!w[e].marked&&(T[e].innerHTML=E)}var c,d,f,p,M,v,g,L,T,H,w,b,k,x,y,E="&lowast;",N="&nbsp;",I="&times;",j=[{name:"初级",width:10,height:10,mines:10},{name:"中级",width:16,height:16,mines:40},{name:"高级",width:30,height:16,mines:99}],q=-1;n()}();